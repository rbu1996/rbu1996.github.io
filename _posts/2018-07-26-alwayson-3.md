---
layout: post
title: SQL Server Always On - 3 (Install SQL server, Availability Group)
date: 2018-07-26 18:00:19.000000000 +09:00
published: true
---

## SQL Server Installation
Download SQL Server     
[https://www.microsoft.com/en-us/download/details.aspx?id=29066](https://www.microsoft.com/en-us/download/details.aspx?id=29066)      
        
==Log in as the local administrator instead of domain administrator!!!!==       
Note: If you use domain user ALWAYSON\Adminisrator to log in to the cluster node and install SQL Server, you will encounter a error that the SQL Server installer will connect to the failover cluster, but in fact, a standalone installation of SQL Server does not require a connection to the failover cluster at all.     
        
==Make sure you have add NET Framework 3.5 Feature'==
        
### Begin the Installation
Open the .exe document   
Uncompress .iso     
Open installation document      

I have created two way mirror to ensure high availability, so the installation path is in E disk and the configuration path is in C disk.     
![sql-1.jpg]({{ "/assets/images/sql-1.jpg" | absolute_url }})               
![sql-2.jpg]({{ "/assets/images/sql-2.jpg" | absolute_url }})            
![sql-3.jpg]({{ "/assets/images/sql-3.jpg" | absolute_url }})       
                
I found this product key from internet, not sure about whether it is working or not.     
![sql-4.jpg]({{ "/assets/images/sql-4.jpg" | absolute_url }})       
![sql-5.jpg]({{ "/assets/images/sql-5.jpg" | absolute_url }})       
![sql-6.jpg]({{ "/assets/images/sql-6.jpg" | absolute_url }})       
![sql-7.jpg]({{ "/assets/images/sql-7.jpg" | absolute_url }})       
![sql-8.jpg]({{ "/assets/images/sql-8.jpg" | absolute_url }})       
![sql-9.jpg]({{ "/assets/images/sql-9.jpg" | absolute_url }})       
        
Select all      
![sql-10.jpg]({{ "/assets/images/sql-10.jpg" | absolute_url }})     
![sql-11.jpg]({{ "/assets/images/sql-11.jpg" | absolute_url }})     
![sql-12.jpg]({{ "/assets/images/sql-12.jpg" | absolute_url }})     
![sql-13.jpg]({{ "/assets/images/sql-13.jpg" | absolute_url }})     
![sql-14.jpg]({{ "/assets/images/sql-14.jpg" | absolute_url }})     
        
Select the Mixed Model      
![sql-15.jpg]({{ "/assets/images/sql-15.jpg" | absolute_url }})     
        
Add Current User or Add by yourself     
![sql-16.jpg]({{ "/assets/images/sql-16.jpg" | absolute_url }})     
![sql-17.jpg]({{ "/assets/images/sql-17.jpg" | absolute_url }})     
![sql-18.jpg]({{ "/assets/images/sql-18.jpg" | absolute_url }})     
![sql-19.jpg]({{ "/assets/images/sql-19.jpg" | absolute_url }})     
![sql-20.jpg]({{ "/assets/images/sql-20.jpg" | absolute_url }})     
![sql-21.jpg]({{ "/assets/images/sql-21.jpg" | absolute_url }})     
![sql-22.jpg]({{ "/assets/images/sql-22.jpg" | absolute_url }})     
![sql-23.jpg]({{ "/assets/images/sql-23.jpg" | absolute_url }})     

### Logon SQL Server
Becasue we install the SQL server as local administrator, we have to change the logon to domain administrator.        
![sql-logon.jpg]({{ "/assets/images/sql-logon.jpg" | absolute_url }}) 

## Availability Group
### Create a test database
I create a very simple database named test with one table and three columns.     
![always-1.jpg]({{ "/assets/images/always-1.jpg" | absolute_url }})     
### Back Up
Check the proprities, make sure the backup model is Full.       
![always-2.jpg]({{ "/assets/images/always-2.jpg" | absolute_url }})       
![always-3.jpg]({{ "/assets/images/always-3.jpg" | absolute_url }})      

Back up the database, and the type is ==Full==      
![always-4.jpg]({{ "/assets/images/always-4.jpg" | absolute_url }})      
![always-5.jpg]({{ "/assets/images/always-5.jpg" | absolute_url }})      

The backup file ==Backup== can be connected by other three nodes.       
The domain administrator ALWAYSON\Administrator has read and write access.      
![always-6.jpg]({{ "/assets/images/always-6.jpg" | absolute_url }})     

Create a new availability group.    
![always-7.jpg]({{ "/assets/images/always-7.jpg" | absolute_url }})      
![always-8.jpg]({{ "/assets/images/always-8.jpg" | absolute_url }})      
![always-9.jpg]({{ "/assets/images/always-9.jpg" | absolute_url }})      
![always-10.jpg]({{ "/assets/images/always-10.jpg" | absolute_url }})      
![always-11.jpg]({{ "/assets/images/always-11.jpg" | absolute_url }})      

Share file location.        
![always-12.jpg]({{ "/assets/images/always-12.jpg" | absolute_url }})      
![always-13.jpg]({{ "/assets/images/always-13.jpg" | absolute_url }})      
![always-14.jpg]({{ "/assets/images/always-14.jpg" | absolute_url }})      
![always-15.jpg]({{ "/assets/images/always-15.jpg" | absolute_url }})      
![always-16.jpg]({{ "/assets/images/always-16.jpg" | absolute_url }})   

### Error 
The share folder cannot be connected, it will report a netowrk error.        
The backup type must be Full.

If these two requirements are not met, errors will be reported. 

## Add Listener
Add listner     
![listen-1.jpg]({{ "/assets/images/listen-1.jpg" | absolute_url }})     
![listen-2.jpg]({{ "/assets/images/listen-2.jpg" | absolute_url }})     
![listen-3.jpg]({{ "/assets/images/listen-3.jpg" | absolute_url }})     
![listen-4.jpg]({{ "/assets/images/listen-4.jpg" | absolute_url }})     

Connect to listener     
![listen-5.jpg]({{ "/assets/images/listen-5.jpg" | absolute_url }})     
![listen-6.jpg]({{ "/assets/images/listen-6.jpg" | absolute_url }})     


## Change the primary replica
![change-pri-1.jpg]({{ "/assets/images/change-pri-1.jpg" | absolute_url }})     
![change-pri-2.jpg]({{ "/assets/images/change-pri-2.jpg" | absolute_url }})     
![change-pri-3.jpg]({{ "/assets/images/change-pri-3.jpg" | absolute_url }})     
![change-pri-4.jpg]({{ "/assets/images/change-pri-4.jpg" | absolute_url }})     
![change-pri-5.jpg]({{ "/assets/images/change-pri-5.jpg" | absolute_url }})     
## Add a Replica to the Cluster
![add-1.jpg]({{ "/assets/images/add-1.jpg" | absolute_url }})     
![add-2.jpg]({{ "/assets/images/add-2.jpg" | absolute_url }})     
![add-3.jpg]({{ "/assets/images/add-3.jpg" | absolute_url }})     
![add-4.jpg]({{ "/assets/images/add-4.jpg" | absolute_url }})     
![add-5.jpg]({{ "/assets/images/add-5.jpg" | absolute_url }})     
![add-6.jpg]({{ "/assets/images/add-6.jpg" | absolute_url }})     
![add-7.jpg]({{ "/assets/images/add-7.jpg" | absolute_url }})     
![add-8.jpg]({{ "/assets/images/add-8.jpg" | absolute_url }})     
![add-9.jpg]({{ "/assets/images/add-9.jpg" | absolute_url }})     
![add-10.jpg]({{ "/assets/images/add-10.jpg" | absolute_url }})      

